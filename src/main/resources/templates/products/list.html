<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/springsecurity5">
<!--<head>-->
<head th:replace="fragments/layout :: head">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <title id="pageTitle">Products</title>
</head>
<body>
<nav th:replace="fragments/layout :: nav"></nav>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h1>Available Products</h1>

      <div sec:authorize="hasRole('ADMIN')" class="mb-3">
        <a href="/products/add" class="btn btn-primary">Add New Product</a>
      </div>

      <table class="table table-striped">
        <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>Price</th>
          <th>Weight</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="product : ${productList}">
          <td th:text="${product.name}"></td>
          <td th:text="${product.category.name}"></td>
          <td th:text="${#numbers.formatDecimal(product.price, 1, 2)} + ' zÅ‚'"></td>
          <td th:text="${product.weight} + ' kg'"></td>
          <!-- Replace the existing td section with this -->
          <td>
            <!-- Common buttons for all users -->
            <div class="d-flex gap-2">
              <!-- Details button for all users -->
              <a class="btn btn-sm btn-info" th:href="@{/products/details(id=${product.id})}">
                <i class="fas fa-info-circle"></i> Details
              </a>

              <!-- Add to cart button for regular users -->
              <div sec:authorize="hasRole('USER')">
                <form th:action="@{/cart/add/{id}(id=${product.id})}" method="post">
                  <button type="submit" class="btn btn-sm btn-success">
                    <i class="fas fa-cart-plus"></i> Add to Cart
                  </button>
                </form>
              </div>

              <!-- Admin buttons -->
              <div sec:authorize="hasRole('ADMIN')" class="d-flex gap-2">
                <a class="btn btn-sm btn-warning" th:href="@{/products/{id}/edit(id=${product.id})}">
                  <i class="fas fa-edit"></i> Edit
                </a>
                <a class="btn btn-sm btn-danger"
                   th:href="@{/products/remove(id=${product.id})}"
                   onclick="return confirm('Are you sure you want to delete this product?');">
                  <i class="fas fa-trash-alt"></i> Remove
                </a>
              </div>
            </div>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
</body>
</html>